# Fix Report - Inefficient Array Shuffle

**Timestamp:** 2026-01-16T17:52:48Z  
**Target Issue:** Inefficient array shuffle  
**Hypothesis:** Using `sort(() => Math.random() - 0.5)` is inefficient and doesn't produce uniform distribution

## Issue Summary

The `renderCredsHistory()` function used an inefficient shuffle method:
```javascript
currentHistoryOrder = [...defaultCreds].filter(c => c && c.user && c.pass).sort(() => Math.random() - 0.5);
```

**Problems with this approach:**
1. **Inefficient**: `sort()` is O(n log n), while Fisher-Yates is O(n)
2. **Non-uniform distribution**: `sort(() => Math.random() - 0.5)` doesn't produce a truly random shuffle - some permutations are more likely than others
3. **Not truly random**: The comparison function doesn't guarantee uniform distribution

## Files Changed

- `creds.js` (lines 64-72)

## What Was Changed

Replaced the inefficient `sort()` shuffle with the Fisher-Yates shuffle algorithm:

**Before:**
```javascript
historyDiv.innerHTML = '';

// Shuffle credentials for random "history" order
currentHistoryOrder = [...defaultCreds].filter(c => c && c.user && c.pass).sort(() => Math.random() - 0.5);
```

**After:**
```javascript
historyDiv.innerHTML = '';

// Filter valid credentials
const validCreds = [...defaultCreds].filter(c => c && c.user && c.pass);

// Shuffle credentials using Fisher-Yates algorithm for uniform distribution
currentHistoryOrder = [...validCreds];
for (let i = currentHistoryOrder.length - 1; i > 0; i--) {
  const j = Math.floor(Math.random() * (i + 1));
  [currentHistoryOrder[i], currentHistoryOrder[j]] = [currentHistoryOrder[j], currentHistoryOrder[i]];
}
```

## Why This Fix Works

The Fisher-Yates shuffle algorithm:
1. **O(n) complexity**: More efficient than O(n log n) sort
2. **Uniform distribution**: Each permutation has equal probability
3. **Truly random**: Guarantees unbiased shuffling
4. **Standard algorithm**: Well-known, proven algorithm for array shuffling

**How it works:**
- Iterate from the last element to the first
- For each position `i`, pick a random index `j` from 0 to `i` (inclusive)
- Swap elements at positions `i` and `j`
- This ensures each element has an equal chance of ending up in any position

## Validation Results

**Test Method:** Syntax check

**Changes:**
- ✅ Replaced inefficient `sort()` shuffle with Fisher-Yates algorithm
- ✅ Separated filtering from shuffling for clarity
- ✅ Algorithm produces uniform random distribution
- ✅ Syntax is valid

**Validation:** ✅ SUCCESS - Inefficient shuffle replaced with Fisher-Yates

## Outcome

✅ **SUCCESS** - Issue resolved. The inefficient `sort(() => Math.random() - 0.5)` shuffle has been replaced with the Fisher-Yates algorithm, providing better performance (O(n) vs O(n log n)) and a truly uniform random distribution.

## Next Recommended Action

Run `web-fix.md` again to address the next code smell:
- **Duplicate color generation logic** - news.js - Extract common logic
